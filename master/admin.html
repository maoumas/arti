<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Teleprompter Studio PRO</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- METADATOS PRO -->
  <meta property="og:title" content="Teleprompter Studio PRO">
  <meta property="og:description" content="Generador de guiones profesional para transmisi√≥n.">
  <meta property="og:image" content="https://placehold.co/1200x630/1e293b/10b981/png?text=TELEPROMPTER+STUDIO">

  <style>
    /* ESTILOS BASE */
    :root {
        --bg-app: #0f172a;
        --bg-panel: #1e293b;
        --accent: #10b981;
        --accent-hover: #059669;
        --text-main: #e2e8f0;
        --border: #334155;
    }

    body {
        background-color: var(--bg-app);
        color: var(--text-main);
        font-family: 'Inter', sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    /* HEADER */
    .header {
        padding: 15px 24px;
        border-bottom: 1px solid var(--border);
        background: var(--bg-panel);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    /* CONTENEDOR PRINCIPAL */
    .main-layout {
        flex: 1;
        display: flex;
        padding: 20px;
        gap: 20px;
        overflow-y: auto;
    }

    /* PANELES */
    .panel {
        background: var(--bg-panel);
        border: 1px solid var(--border);
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
    }

    /* EDITOR */
    .editor-section {
        flex: 2;
        display: flex;
        flex-direction: column;
        min-height: 300px;
    }

    textarea {
        flex: 1;
        background: transparent;
        border: none;
        padding: 20px;
        color: #fff;
        font-family: 'JetBrains Mono', monospace;
        font-size: 16px;
        line-height: 1.6;
        resize: none;
        outline: none;
    }

    /* SIDEBAR */
    .sidebar-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 20px;
        min-width: 320px;
    }

    /* BARRA DE ACCIONES */
    .actions-bar {
        background: var(--bg-panel);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    /* BOTONES */
    .btn {
        display: inline-flex; justify-content: center; items-center; gap: 10px;
        padding: 14px 20px;
        border-radius: 8px;
        font-weight: 700;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.2s;
        border: 1px solid transparent;
        width: 100%;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .btn-live { 
        background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%); 
        color: #022c22; 
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        font-size: 1.1rem;
        padding: 18px;
    }
    .btn-live:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(16, 185, 129, 0.4); }
    .btn-live:active { transform: scale(0.98); }

    .btn-secondary { background: #334155; color: #fff; border-color: #475569; font-size: 0.85rem; padding: 10px;}
    .btn-secondary:hover { background: #475569; }
    
    .btn-outline { background: transparent; color: #94a3b8; border: 1px dashed #475569; font-size: 0.85rem; padding: 10px; }
    .btn-outline:hover { border-color: #94a3b8; color: #fff; }

    /* PANEL INFO */
    .control-panel {
        flex: 1;
        padding: 20px;
        align-items: center;
        text-align: center;
        justify-content: flex-start;
        opacity: 0.8;
    }

    /* M√ìVIL */
    @media (max-width: 768px) {
        body { height: auto; overflow-y: auto; }
        .main-layout { flex-direction: column; padding: 15px; gap: 15px; }
        .editor-section { min-height: 50vh; order: 1; }
        .sidebar-section { order: 2; min-width: 100%; gap: 15px; }
    }

    @media print {
        body * { visibility: hidden; }
        #print-area, #print-area * { visibility: visible; }
        #print-area { position: absolute; left: 0; top: 0; width: 100%; color: black; background: white; padding: 40px; }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div class="flex items-center gap-3">
        <span class="text-3xl">üì°</span>
        <div>
            <h1 class="text-xl font-bold tracking-tight text-white">Teleprompter Studio <span class="text-emerald-500">PRO</span></h1>
            <p class="text-xs text-slate-400 font-mono">v3.6 // Mobile Touch</p>
        </div>
    </div>
  </header>

  <div class="main-layout">
    
    <!-- EDITOR -->
    <div class="panel editor-section">
        <div class="bg-slate-900/50 p-3 border-b border-slate-700 flex justify-between items-center">
            <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Editor de Gui√≥n</span>
            <span class="text-[10px] text-slate-600 font-mono bg-slate-800 px-2 py-1 rounded">MARKDOWN</span>
        </div>
        <textarea id="input" placeholder="# T√≠tulo del Programa&#10;* [Instrucci√≥n: C√°mara 1]&#10;&#10;Pega tu texto aqu√≠..."></textarea>
    </div>

    <!-- SIDEBAR -->
    <div class="sidebar-section">
        
        <!-- BARRA DE ACCIONES -->
        <div class="actions-bar">
            
            <input type="file" id="fileImport" accept=".txt,.md,.json" style="display: none;" onchange="importFile(this)">
            <button class="btn btn-secondary" onclick="document.getElementById('fileImport').click()">
                <span>üìÇ</span> Importar Texto
            </button>

            <div class="my-2">
                <button class="btn btn-live" onclick="testLive()">
                    <span>‚ñ∂</span> LANZAR AHORA
                </button>
                <p class="text-[10px] text-center text-slate-500 mt-2 font-mono">Abre Player Instant√°neo</p>
            </div>

            <hr class="border-slate-700">

            <div class="grid grid-cols-2 gap-2">
                <button class="btn btn-outline" onclick="generatePDF()">
                    <span>üìÑ</span> Guardar PDF
                </button>
                <button class="btn btn-outline" onclick="exportPlayer()">
                    <span>üíæ</span> Guardar HTML
                </button>
            </div>
        </div>

        <!-- PANEL DE ESTADO -->
        <div class="panel control-panel">
            <h3 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-4">Mejoras V3.6</h3>
            
            <div class="w-full bg-slate-900 rounded p-3 text-left space-y-2 mb-4">
                <div class="flex justify-between text-[11px] font-mono text-slate-400 border-b border-slate-800 pb-1">
                    <span>TOUCH PLAY</span> <span class="text-emerald-400">ACTIVO</span>
                </div>
                <div class="flex justify-between text-[11px] font-mono text-slate-400 border-b border-slate-800 pb-1">
                    <span>DISE√ëO</span> <span class="text-emerald-400">FULL WIDTH</span>
                </div>
                <div class="flex justify-between text-[11px] font-mono text-slate-400">
                    <span>BOTONES</span> <span class="text-emerald-400">ADAPTATIVOS</span>
                </div>
            </div>
            
            <p class="text-[10px] text-slate-600">
                Toca cualquier parte de la pantalla negra para Pausar/Arrancar el teleprompter.
            </p>
        </div>

    </div>
  </div>

  <div id="print-area" style="display:none;"></div>

  <script>
    function importFile(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) { document.getElementById('input').value = e.target.result; };
        reader.readAsText(file);
        input.value = '';
    }

    function generatePDF() {
        const raw = document.getElementById('input').value;
        const lines = raw.split('\n');
        let html = '<h1 style="margin-bottom:20px; font-family:sans-serif;">Gui√≥n de Teleprompter</h1>';
        lines.forEach(line => {
            if(line.startsWith('#')) html += `<h2 style="color:#000; border-bottom:2px solid black; padding-bottom:5px;">${line.substring(1)}</h2>`;
            else if(line.startsWith('*')) html += `<p style="color:#666; font-style:italic; font-weight:bold; background:#eee; padding:5px;">[DIR] ${line.substring(1)}</p>`;
            else if(line.trim() !== '') html += `<p style="font-size:14pt; line-height:1.5; font-family:serif;">${line}</p>`;
        });
        document.getElementById('print-area').innerHTML = html;
        window.print();
    }

    // Extractor de t√≠tulo para metadatos
    function getTitleFromScript() {
        const raw = document.getElementById('input').value;
        const lines = raw.split('\n');
        for(let line of lines) {
            if(line.startsWith('#')) return line.substring(1).trim();
        }
        return "Teleprompter Studio";
    }

    function parseScript() {
        const raw = document.getElementById('input').value;
        const lines = raw.split('\n');
        let scriptData = [];
        lines.forEach(line => {
            line = line.trim();
            if (!line) return;
            if (line.startsWith('#')) scriptData.push({ type: "title", content: line.substring(1).trim() });
            else if (line.startsWith('*')) scriptData.push({ type: "instruction", content: line.substring(1).trim() });
            else scriptData.push({ type: "text", content: line });
        });
        if (scriptData.length === 0) scriptData = [{ type: "title", content: "DEMO" }, { type: "text", content: "Escribe tu texto..." }];
        return JSON.stringify(scriptData);
    }

    function getPlayerHTML(jsonData) {
        const scriptTitle = getTitleFromScript();
        // URL din√°mica de imagen para la tarjeta de WhatsApp
        const ogImage = `https://placehold.co/1200x630/000000/10b981/png?text=${encodeURIComponent(scriptTitle.toUpperCase())}&font=roboto`;
        
        return `<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${scriptTitle} - Teleprompter</title>
<!-- METADATOS DIN√ÅMICOS -->
<meta property="og:title" content="${scriptTitle}">
<meta property="og:description" content="Gui√≥n de Teleprompter listo para transmisi√≥n.">
<meta property="og:image" content="${ogImage}">
<meta property="og:type" content="website">

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
  body{background:#000;color:#fff;font-family:'Inter',sans-serif;margin:0;overflow:hidden;height:100vh;display:flex;flex-direction:column;}
  
  /* √ÅREA DE TEXTO */
  #prompter-area{
      flex:1;
      overflow-y:scroll;
      padding:50px 20px;
      padding-bottom:50vh; /* Espacio para que el final llegue al centro */
      cursor: pointer; /* Indica que es clicable */
  }
  
  .p-text{font-size:3.5rem;line-height:1.4;margin-bottom:1.5rem;font-weight:700;}
  .p-title{color:#10B981;font-size:2rem;text-transform:uppercase;letter-spacing:2px;border-bottom:1px solid #333;margin:40px 0 20px 0;}
  .p-inst{color:#F59E0B;font-size:1.8rem;font-style:italic;background:#1e1e1e;padding:15px;border-left:5px solid #F59E0B;}
  
  /* ESPEJO */
  .mirror-x { transform: scaleX(-1); } .mirror-y { transform: scaleY(-1); }
  
  /* CONTROLES UNIFICADOS (ABAJO) */
  #controls {
      position:fixed; bottom:0; left:0; width:100%;
      background: #000; /* Fondo s√≥lido para mejor contraste en m√≥vil */
      border-top: 1px solid #333;
      padding: 10px;
      display:flex; justify-content: space-between; align-items:center;
      z-index:999; 
      box-sizing: border-box; /* Evita que el padding rompa el ancho */
  }

  /* GRUPOS DE CONTROL */
  .c-group { display:flex; gap:5px; align-items:center; background:#111; padding:4px; border-radius:12px; border:1px solid #333; }
  
  button {
      background:#222; border:none; color:#fff;
      width:42px; height:42px; border-radius:8px; /* Cuadrado redondeado */
      font-weight:bold; cursor:pointer; font-size:1.1rem;
      display:flex; align-items:center; justify-content:center;
      transition:0.2s;
  }
  button:hover { background:#444; }
  
  /* BOT√ìN PRINCIPAL (TEXTO) */
  button.btn-main {
      width:auto; padding:0 20px; height:50px; border-radius:12px;
      background:#10B981; color:#000; font-size:1rem; text-transform:uppercase;
      box-shadow: 0 0 10px rgba(16,185,129,0.2);
      min-width: 90px;
  }
  button.btn-main:hover { transform:scale(1.02); }
  button.btn-main.paused { background:#EF4444; color:#fff; box-shadow: 0 0 10px rgba(239,68,68,0.2); }

  /* Ocultar etiquetas en m√≥vil */
  .label { font-family:monospace; font-size:9px; color:#666; text-align:center; display:block; margin-bottom:2px; text-transform:uppercase; }
  .val { font-family:monospace; font-size:14px; width:25px; text-align:center; font-weight:bold; }

  /* Media Query para M√≥viles */
  @media (max-width: 600px) {
      .label { display: none; } /* Ahorra espacio vertical */
      #controls { padding: 10px 5px; gap: 5px; }
      button { width: 38px; height: 38px; }
      .c-group { padding: 2px; }
      /* Esconder espejo en m√≥vil vertical muy estrecho si hace falta */
  }

  #guide{position:fixed;top:45%;left:0;width:100%;height:10%;border-top:2px dashed rgba(255,0,0,0.3);border-bottom:2px dashed rgba(255,0,0,0.3);pointer-events:none;z-index:50;}
</style>
</head>
<body>
  <div id="guide"></div>
  <div id="prompter-area"><div id="content"></div></div>
  
  <div id="controls">
    <!-- VELOCIDAD (IZQ) -->
    <div>
        <span class="label">VELOCIDAD</span>
        <div class="c-group">
            <button onclick="changeSpeed(-1)">-</button>
            <span class="val" id="spdVal">3</span>
            <button onclick="changeSpeed(1)">+</button>
        </div>
    </div>

    <!-- PLAY / PAUSE (CENTRO) -->
    <button onclick="togglePlay()" id="btnPlay" class="btn-main">INICIAR</button>

    <!-- DERECHA: FUENTE + ESPEJO -->
    <div style="display:flex; gap:5px;">
        <!-- Fuente -->
        <div>
            <span class="label">FUENTE</span>
            <div class="c-group">
                <button onclick="changeSize(-1)">A-</button>
                <span class="val" id="fntVal">3</span>
                <button onclick="changeSize(1)">A+</button>
            </div>
        </div>
        <!-- Espejo (Compacto) -->
        <div>
             <span class="label">ESPEJO</span>
             <div class="c-group">
                <button onclick="toggleMirror()" title="Espejo">‚áÑ</button>
             </div>
        </div>
    </div>
  </div>

<script>
  const data = ${jsonData};
  const content = document.getElementById('content');
  const area = document.getElementById('prompter-area');
  
  data.forEach(item => {
    let el = document.createElement('div');
    if(item.type==='title') { el.className='p-title'; el.innerText=item.content; }
    else if(item.type==='instruction') { el.className='p-inst'; el.innerText=item.content; }
    else { el.className='p-text'; el.innerText=item.content; }
    content.appendChild(el);
  });

  let playing=false, speed=3, font=3.5, mirrorState=0, animationId;
  let accumulator = 0; 

  // AUTO-START
  setTimeout(() => {
     if(!playing) togglePlay();
  }, 2000);

  // CLICK TO PLAY/PAUSE (T√ÅCTIL)
  area.addEventListener('click', (e) => {
      // Evitar conflicto si se selecciona texto
      if (window.getSelection().toString().length === 0) {
          togglePlay();
      }
  });

  function loop() {
    if(playing) {
      const move = 0.3 + (speed * 0.15);
      accumulator += move;
      if(accumulator >= 1) {
          const pixels = Math.floor(accumulator);
          area.scrollBy(0, pixels);
          accumulator -= pixels;
      }
      animationId = requestAnimationFrame(loop);
    }
  }

  function togglePlay() {
    playing = !playing;
    const btn = document.getElementById('btnPlay');
    if(playing) {
        btn.innerText = 'PAUSA';
        btn.classList.add('paused');
        loop();
    } else {
        btn.innerText = 'INICIAR';
        btn.classList.remove('paused');
        cancelAnimationFrame(animationId);
    }
  }

  function changeSpeed(d) { 
      speed = Math.max(1, Math.min(50, speed + d)); 
      document.getElementById('spdVal').innerText = speed; 
  }

  function changeSize(d) { 
      font = Math.max(1.5, Math.min(8, font + d * 0.5)); 
      document.querySelectorAll('.p-text').forEach(e => e.style.fontSize = font + 'rem');
      document.getElementById('fntVal').innerText = Math.round(font*10)/10;
  }

  function toggleMirror() { 
      mirrorState = (mirrorState + 1) % 3; 
      const c = document.getElementById('prompter-area'); 
      c.className = ''; 
      if(mirrorState === 1) c.classList.add('mirror-x'); 
      if(mirrorState === 2) c.classList.add('mirror-y'); 
  }

  document.addEventListener('keydown', (e) => { 
      if(e.code === 'Space') { e.preventDefault(); togglePlay(); } 
      if(e.code === 'ArrowUp') changeSpeed(1); 
      if(e.code === 'ArrowDown') changeSpeed(-1); 
  });
<\/script>
</body>
</html>`;
    }

    function exportPlayer() {
        const json = parseScript();
        const html = getPlayerHTML(json);
        const scriptTitle = getTitleFromScript();
        const cleanTitle = scriptTitle.replace(/[^a-z0-9]/gi, '_').toLowerCase();
        
        const blob = new Blob([html], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `Prompter_${cleanTitle}.html`;
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }

    function testLive() {
        const json = parseScript();
        const html = getPlayerHTML(json);
        const win = window.open('', '_blank', 'width=1000,height=800,menubar=no,toolbar=no,location=no,status=no');
        if(win) win.document.write(html); else alert("Habilita Pop-ups");
    }
  </script>
</body>
</html>

