<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Teleprompter para Arti</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: sans-serif; background: #f3f4f6; padding: 20px; color: #1f2937; padding-bottom: 100px; /* M√°s espacio abajo */ }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); position: relative; z-index: 1; }
        
        .instructions { background: #e0f2fe; padding: 15px; border-left: 5px solid #3b82f6; margin-bottom: 20px; color: #1e3a8a; }
        .instructions p.font-bold { color: #1e40af; }
        .instructions code { background: #bfdbfe; color: #1e3a8a; padding: 2px 5px; border-radius: 3px; font-weight: bold; }
        .instructions li { margin-bottom: 0.5rem; }

        /* Forzamos texto NEGRO sobre fondo BLANCO */
        textarea { 
            width: 100%; 
            height: 300px; 
            padding: 10px; 
            border: 2px solid #9ca3af; 
            border-radius: 5px; 
            font-size: 16px; 
            margin-bottom: 20px; 
            background-color: #ffffff !important; 
            color: #000000 !important; 
        }

        /* --- CORRECCI√ìN AQU√ç --- */
        /* Barra inferior fija para el bot√≥n Generar */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.2); /* Sombra m√°s fuerte para destacar */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999; /* ¬°IMPORTANTE! Asegura que est√© siempre encima de todo */
            border-top: 1px solid #e5e7eb;
        }

        button { background: #10B981; color: white; font-weight: bold; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 18px; transition: 0.3s; width: 100%; max-width: 400px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        button:hover { background: #059669; transform: translateY(-2px); }
        button:active { transform: translateY(0); }
        
        h1 { color: #1f2937; }
        h3 { color: #374151; }

        /* Mensaje de generaci√≥n */
        #generation-message {
            display: none;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #3B82F6; /* Azul para que se note distinto al bot√≥n */
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            font-weight: bold;
            z-index: 10000; /* Encima de todo */
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

<div id="generation-message">procesando archivo... por favor espere.</div>

<div class="container">
    <h1 class="text-2xl font-bold mb-4">Generador M√°gico para Arti ü™Ñ (Versi√≥n Alemana)</h1>
    
    <div class="instructions">
        <p class="font-bold">C√≥mo usar esto (Instrucciones para Arti):</p>
        <ul class="list-disc pl-5 mt-2">
            <li>Pega tu guion en el cuadro grande de abajo.</li>
            <li>Si una l√≠nea es un <b>T√çTULO AZUL</b>, pon un <code>#</code> al principio (Ej: <code># KAPITEL 1</code>).</li>
            <li>Si es una <b>NOTA AMARILLA</b>, pon un <code>*</code> (Ej: <code>* Pause hier</code>).</li>
            <li>El resto ser√° texto negro normal.</li>
            <li><b>¬°El bot√≥n verde para generar est√° en la barra inferior fija!</b> üëá</li>
        </ul>
    </div>

    <h3 class="font-bold mb-2 text-lg">Pega tu texto aqu√≠:</h3>
    
    <textarea id="inputText" placeholder="# TITEL DES PROGRAMMS

* Kurze Pause f√ºr Applaus

Guten Abend, meine Damen und Herren.
Dies ist der Haupttext f√ºr den Sprecher.

# N√ÑCHSTER ABSCHNITT

Hier geht es weiter..."></textarea>

</div>

<div class="bottom-bar">
    <button onclick="generateAndDownload()">2. ¬°GENERIEREN & HERUNTERLADEN!</button>
</div>

<script>
    // ====================================================================
    // PLANTILLA MAESTRA ALEMANA (tp-master-2025-de.html) INCRUSTADA
    // ====================================================================

    const htmlTop = `<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta property="og:title" content="Neuer Teleprompter" /><meta property="og:description" content="Skript f√ºr den Moderator" />
<meta property="og:image" content="https://zmau.dev/epst/img/IMG_X.JPG" />
<title>Teleprompter</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
body { background-color: #000; color: #f0f0f0; font-family: 'Inter', sans-serif; }
/* STEUERLEISTE (Eine Zeile) */
#controls { position: sticky; bottom: 0; left: 0; right: 0; background-color: #111; border-top: 1px solid #333; padding: 8px 4px; display: flex; flex-wrap: nowrap; justify-content: space-between; align-items: center; gap: 4px; z-index: 1000; box-shadow: 0 -10px 20px rgba(0,0,0,0.9); overflow-x: auto; -webkit-overflow-scrolling: touch; }
.btn-main { height: 44px; padding: 0 12px; border-radius: 8px; font-weight: 700; text-transform: uppercase; cursor: pointer; border: none; color: white; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0; white-space: nowrap; }
.btn-main:active { transform: scale(0.95); }
#play-pause-btn { background-color: #10B981; min-width: 80px; transition: background-color 0.3s; } 
#play-pause-btn.paused { background-color: #EF4444; } 
#reset-btn { background-color: #374151; width: 44px; padding: 0; }
.control-group { display: flex; align-items: center; gap: 1px; background-color: #222; padding: 2px; border-radius: 8px; border: 1px solid #444; flex-shrink: 0; }
.group-icon { padding: 0 6px; display: flex; align-items: center; justify-content: center; color: #888; }
.material-icons { font-size: 20px; }
.stepper-btn { width: 40px; height: 40px; border-radius: 6px; border: none; font-size: 1.4rem; line-height: 1; font-weight: bold; cursor: pointer; color: white; display: flex; justify-content: center; align-items: center; transition: background 0.1s; }
.value-display { font-family: monospace; font-size: 1.1rem; font-weight: bold; min-width: 24px; text-align: center; color: #fff; user-select: none; }
.theme-speed .stepper-btn { background-color: #1E40AF; } .theme-speed .stepper-btn:active { background-color: #3B82F6; } .theme-speed .group-icon { color: #60A5FA; }
.theme-font .stepper-btn { background-color: #92400E; } .theme-font .stepper-btn:active { background-color: #F59E0B; } .theme-font .group-icon { color: #FBBF24; }
.toggle-container { display: none; } 
@media (min-width: 768px) { #controls { justify-content: center; gap: 1.5rem; padding: 1rem; } .toggle-container { display: flex; align-items: center; gap: 0.5rem; color: #888; font-size: 0.8rem; margin-left: 10px;} .btn-main { font-size: 1rem; padding: 0 20px; } }
/* Textbereich */
#script-container { padding: 1rem 1.5rem; padding-bottom: 70vh; max-width: 900px; margin: 0 auto; line-height: 1.5; }
.speaker-text { font-size: 2.5rem; font-weight: 600; color: #ffffff; margin-bottom: 1.5rem; transition: font-size 0.1s; }
.instruction { font-size: 1.2rem; color: #FCD34D; font-style: italic; background-color: #282518; border-left: 4px solid #F59E0B; padding: 1rem; margin-bottom: 1.5rem; border-radius: 0 8px 8px 0; opacity: 0.9; }
.timestamp { font-size: 1.5rem; font-weight: 700; color: #60A5FA; border-top: 1px solid #333; padding-top: 2rem; margin-top: 3rem; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 1px; }
body.hide-instructions .instruction { display: none; }
</style>
</head>
<body class="">
<div id="script-container"></div>
<div id="controls">
<div style="display:flex; gap:4px; flex-shrink:0;"><button id="play-pause-btn" class="btn-main">START</button><button id="reset-btn" class="btn-main"><span class="material-icons" style="font-size:24px;">replay</span></button></div>
<div class="control-group theme-speed"><div class="group-icon"><span class="material-icons">bolt</span></div><button class="stepper-btn" id="speed-minus">‚àí</button><div class="value-display" id="speed-display">3</div><button class="stepper-btn" id="speed-plus">+</button></div>
<div class="control-group theme-font"><div class="group-icon"><span class="material-icons">text_fields</span></div><button class="stepper-btn" id="font-minus">‚àí</button><div class="value-display" id="font-display">3</div><button class="stepper-btn" id="font-plus">+</button></div>
<div class="toggle-container"><input type="checkbox" id="toggle-instructions"> <label for="toggle-instructions">Regie ausblenden</label></div>
</div>
<script type="module">
// HIER WIRD DAS SKRIPT EINGEF√úGT
const scriptData = [`;

    const htmlBottom = `
];
document.addEventListener('DOMContentLoaded', () => {
  const scriptContainer = document.getElementById('script-container');
  scriptData.forEach(item => {
      let el;
      if (item.type === 'title') { el = document.createElement('h2'); el.className = 'timestamp'; } 
      else if (item.type === 'instruction') { el = document.createElement('p'); el.className = 'instruction'; } 
      else { el = document.createElement('p'); el.className = 'speaker-text'; }
      el.textContent = item.content; scriptContainer.appendChild(el);
  });
  let state = { speedLevel: 3, fontLevel: 3, isScrolling: false };
  let animationFrameId = null;
  const btnPlay = document.getElementById('play-pause-btn'); const btnReset = document.getElementById('reset-btn'); const toggleInstr = document.getElementById('toggle-instructions');
  const btnSpeedMinus = document.getElementById('speed-minus'); const btnSpeedPlus = document.getElementById('speed-plus'); const dispSpeed = document.getElementById('speed-display');
  const btnFontMinus = document.getElementById('font-minus'); const btnFontPlus = document.getElementById('font-plus'); const dispFont = document.getElementById('font-display');
  function updateFont() { const baseSize = 24; const stepSize = 7; const pixelSize = baseSize + (state.fontLevel * stepSize); document.querySelectorAll('.speaker-text, .timestamp').forEach(el => { el.style.fontSize = pixelSize + 'px'; }); dispFont.textContent = state.fontLevel; }
  // GESCHWINDIGKEITSFORMEL "ARTI"
  function getScrollPixelPerFrame() { const val = state.speedLevel; if (val === 0) return 0; return (val * 5 + Math.pow(val, 2)) / 60; }
  function updateSpeedDisplay() { dispSpeed.textContent = state.speedLevel; }
  function loop() { if (!state.isScrolling) return; const pixels = getScrollPixelPerFrame(); if (pixels > 0) { window.scrollBy(0, pixels); } animationFrameId = requestAnimationFrame(loop); }
  function togglePlay() { state.isScrolling = !state.isScrolling; if (state.isScrolling) { btnPlay.textContent = "PAUSA"; btnPlay.classList.add('paused'); loop(); } else { btnPlay.textContent = "START"; btnPlay.classList.remove('paused'); cancelAnimationFrame(animationFrameId); } }
  btnSpeedMinus.addEventListener('click', () => { if (state.speedLevel > 0) { state.speedLevel--; updateSpeedDisplay(); } });
  btnSpeedPlus.addEventListener('click', () => { if (state.speedLevel < 20) { state.speedLevel++; updateSpeedDisplay(); } });
  btnFontMinus.addEventListener('click', () => { if (state.fontLevel > 0) { state.fontLevel--; updateFont(); } });
  btnFontPlus.addEventListener('click', () => { if (state.fontLevel < 15) { state.fontLevel++; updateFont(); } });
  btnPlay.addEventListener('click', togglePlay);
  btnReset.addEventListener('click', () => { window.scrollTo(0, 0); state.isScrolling = false; btnPlay.textContent = "START"; btnPlay.classList.remove('paused'); cancelAnimationFrame(animationFrameId); });
  document.addEventListener('keydown', (e) => { if (e.key === ' ') { e.preventDefault(); togglePlay(); } });
  toggleInstr.addEventListener('change', (e) => { document.body.classList.toggle('hide-instructions', e.target.checked); });
  updateFont(); updateSpeedDisplay();
  // AUTO-START 2 SEKUNDEN
  setTimeout(() => { if (!state.isScrolling) { togglePlay(); } }, 2000);
});
<\/script></body></html>`;

    // ====================================================================
    // L√ìGICA DEL GENERADOR
    // ====================================================================

    function generateAndDownload() {
        // Mostrar mensaje de generaci√≥n
        const message = document.getElementById('generation-message');
        message.style.display = 'block';

        const rawText = document.getElementById('inputText').value;
        const lines = rawText.split('\n');
        let scriptJson = "";

        lines.forEach(line => {
            line = line.trim();
            if (!line) return; // Ignorar l√≠neas vac√≠as

            if (line.startsWith('#')) {
                // Es un t√≠tulo
                let content = line.substring(1).trim();
                scriptJson += `{ type: "title", content: "${escapeStr(content)}" },\n`;
            } else if (line.startsWith('*')) {
                // Es una instrucci√≥n
                let content = line.substring(1).trim();
                scriptJson += `{ type: "instruction", content: "${escapeStr(content)}" },\n`;
            } else {
                // Es texto normal
                scriptJson += `{ type: "text", content: "${escapeStr(line)}" },\n`;
            }
        });

        // Combinar todo
        const fullHtml = htmlTop + scriptJson + htmlBottom;

        // Crear Blob y descargar
        const blob = new Blob([fullHtml], { type: 'text/html' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        
        // Nombre del archivo con fecha
        const date = new Date();
        const dateStr = date.getFullYear() + "-" + (date.getMonth()+1).toString().padStart(2, '0') + "-" + date.getDate().toString().padStart(2, '0') + "_" + date.getHours().toString().padStart(2, '0') + date.getMinutes().toString().padStart(2, '0');
        link.download = `teleprompter-${dateStr}.html`;
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // Ocultar mensaje despu√©s de un breve retraso
        setTimeout(() => {
            message.style.display = 'none';
        }, 3000);
    }

    function escapeStr(str) {
        // Escapar comillas dobles y barras invertidas para el JSON
        return str.replace(/\\/g, '\\\\').replace(/"/g, '\\"');
    }
</script>

</body>
</html>